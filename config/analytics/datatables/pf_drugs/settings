nameSingle: drug
namePlural: drugs

cacheTableInConfig: true

primKey: drug_id

icon: docimage:icons/drug02.svg

properties:
- id: drug_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="drugs.jpg">
        <BreadCrumb a="pf" b="drugs"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                  <Typography type="headline">
                      {{name}}
                  </Typography>
                  <Typography component="p" style="padding-bottom:8px">
                      {{{description}}}
                  </Typography>
                  <Typography component="div" align="center">
                      {{#each pf_resgenes}}
                          <ItemLink table="pf_resgenes" primKey="{{gene_id}}" button> Gene: {{name}} </ItemLink>
                      {{/each}}
                  </Typography>
                  <div style="padding-top:10px;">
                    <div class="auto-half-height-container">
                       <div class="auto-height-inner">
                        <Map>
                          <TileLayer/>
                          <TableGeoJSONsLayer
                            onClickBehaviour="tooltip"
                            onClickComponent="DocPage"
                            onClickComponentProps='{"drug_id":"{{drug_id}}","drug_name":"{{name}}","dynamicSize":"true", "path":"templates/regionCloroplethTooltip.html"}'
                            table="pf_regions"
                            geoJsonProperty="geojson"
                            colourProperty="{{drug_id}}resistance"
                            showLegend="false"
                            geoJsonStrokeOpacity="0.7"
                            geoJsonFillOpacity="0.7"
                          />
                        </Map>
                      </div>
                    </div>
                  </div>
                  <DocTemplate path="templates/resistanceMapLegend.html"/>
                  <DocTemplate path="templates/resistanceMapButton.html"/>
                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                     {{name}} resistance by region
                    </Typography>

                    <DocTemplate path="templates/proportionPlotTitle.html"/>
                    <Typography component="div">

                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            rowTableOrder='[["asc", "region_id"]]'
                            proportionTable="pf_samples"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"sensitive","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="ItemLink"
                            onClickTable="pf_drug_regions"
                            onClickPrimKey="{{drug_id}}_{}"
                            colourProperty="pf_regions.{{drug_id}}resistance"
                            rawNumerator="true"
                          />
                        </div>

                    </Typography>
                    <DocTemplate path="templates/proportionPlotLegend.html"/>
                </CardContent>
            </Card>
            <DocTemplate path="templates/sop.html"/>
        </CardStack>
    </PageTemplate>
