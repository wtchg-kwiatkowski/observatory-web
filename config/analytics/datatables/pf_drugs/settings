nameSingle: drug
namePlural: drugs

primKey: drug_id

icon: docimage:icons/drug02.svg

properties:
- id: drug_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="drugs.jpg">
        <BreadCrumb a="pf" b="drugs"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                  <Typography type="headline">
                      {{name}}
                  </Typography>
                  <Typography component="p" style="padding-bottom:8px">
                      {{{description}}}
                  </Typography>
                  <Typography component="div" align="center">
                      {{#each pf_resgenes}}
                          <ItemLink table="pf_resgenes" primKey="{{gene_id}}" button> Gene: {{name}} </ItemLink>
                      {{/each}}
                  </Typography>
                  <div style="padding-top:10px;">
                    <div class="auto-half-height-container">
                       <div class="auto-height-inner">
                        <Map disableInteraction>
                          <TileLayer/>
                          <TableGeoJSONsLayer
                            onClickBehaviour="tooltip"
                            onClickComponent="DocPage"
                            onClickComponentProps='{"drug_id":"{{drug_id}}","drug_name":"{{name}}","dynamicSize":"true", "path":"templates/regionCloroplethTooltip.html"}'
                            table="pf_regions"
                            geoJsonProperty="geojson"
                            colourProperty="{{drug_id}}resistance"
                            max="70"
                            min="0"
                            showLegend="false"
                          />
                        </Map>
                      </div>
                    </div>
                  </div>
                  <Typography component="div">
                    <ColourPropertyLegend
                      colourProperty="{{drug_id}}resistance"
                      table="pf_regions"
                      max="70"
                      min="0"
                    />
                  </Typography>
                  <Typography component="div" align="center" style="padding-top:20px;">
                    <DocLink button href="viewers/ResistanceMap.html" initialDrug="{{drug_id}}">
                      <Icon
                        name="docimage:icons/viewer.svg"
                        style="margin-right: 0.5em;"
                      />
                      Explore resistance
                    </DocLink>
                  </Typography>
                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                     {{name}} resistance by region
                    </Typography>

                    <DocTemplate path="templates/proportionPlotTitle.html"/>
                    <Typography component="div">

                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            proportionTable="pf_samples"
                            proportionTableColourColumn="{{drug_id}}resistant"
                            proportionTableColourColumnNumeratorValue="resistant"
                            numeratorBarColour="{{colour 'numeratorBar'}}"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"sensitive","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="ItemLink"
                            onClickTable="pf_drug_regions"
                            onClickPrimKey="{{drug_id}}_{}"
                          />
                        </div>

                    </Typography>
                    <DocTemplate path="templates/proportionPlotLegend.html"/>

                </CardContent>
            </Card>
            <Card >
                <CardContent>
                    <Typography type="headline">
                        How we predict resistance
                    </Typography>
                    <List>
                      <ObsListItem download href="downloads/Markers_to_phenotype_mapping_-_SOP_v1_2.pdf" target="_blank">
                        <ListItemIcon><Icon class="icon" name='docimage:icons/publications-reports.svg' />
                        </ListItemIcon>
                          <ListItemText>
                          <span>Our standard operating procedure for inferring antimalarial resistance from DNA</span>
                        </ListItemText>
                      </ObsListItem>
                    </List>
                </CardContent>
            </Card>

        </CardStack>
    </PageTemplate>
