nameSingle: gene
namePlural: genes

primKey: gene_id

icon: docimage:icons/gene02.svg

properties:
- id: gene_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text
- id: long_name
  dataType: Text
- id: marker_name
  dataType: Text
- id: related_drug_id
  dataType: Text
  relation:                         # This block defines a many-to-one foreign relation to a parent table
      tableId: pf_drugs             # Datatable id of the parent table
      forwardName: blank
      reverseName: blank


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="mapgenome.jpg">
        <BreadCrumb a="pf" b="genes"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                    <Typography type="headline">
                     <em>{{name}}</em> - {{capitalizeAll long_name}}
                    </Typography>
                    <Typography component="div" style="padding-bottom:8px">
                        {{{short_description}}}. <em>{{name}}</em> is also known as {{gene_id}}.
                    </Typography>
                    <Typography component="p">
                      {{{description}}}
                    </Typography>

                    <Typography component="div" align="center" style="padding-bottom: 10px; padding-top: 10px">
                            <ItemLink table="pf_drugs" primKey="{{related_drug_id}}" button> Drug: {{pf_drugs.name}} </ItemLink>
                    </Typography>

                </CardContent>
            </Card>
            <Card>

            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                    Predicted {{lowercase pf_drugs.name}} resistance by region
                    </Typography>
                    <DocTemplate path="templates/proportionPlotTitle.html"/>
                    <Typography component="div">
                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            rowTableOrder='[["asc", "region_id"]]'
                            proportionTable="pf_samples"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{pf_drugs.drug_id}}resistant","CompValue":"resistant","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{pf_drugs.drug_id}}resistant","CompValue":"resistant","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{pf_drugs.drug_id}}resistant","CompValue":"sensitive","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="ItemLink"
                            onClickTable="pf_drug_regions"
                            onClickPrimKey="{{pf_drugs.drug_id}}_{}"
                            colourProperty="pf_regions.{{pf_drugs.drug_id}}resistance"
                            rawNumerator="true"
                          />
                        </div>
                    </Typography>
                    <DocTemplate path="templates/proportionPlotLegend.html"/>
                </CardContent>
            </Card>


            <Card>
                <CardContent>
                    <Typography type="headline">
                        Variation within the <em>{{name}}</em> gene
                    </Typography>
                    <Typography type="subheading" color="secondary">

                    </Typography>
                    <Typography component="p">
                        A gene is a sequence of DNA within a genome that codes for a molecule with a particular function. This means that changes in the DNA <em>within</em> a gene lead to changes in the function of that gene. Most genes code for proteins, which are made up of amino acids, and it is the DNA sequence directly that codes for these amino acids.
                    </Typography>
                    <Typography component="p">
                        Geneticists look for changes to DNA, or mutations, that cause changes to the amino acids that are coded by genes. These so-called <em>non-synonymous</em> mutations hint at underlying differences in the biology between groups with different versions of the mutation, and so are good candidates for the target of natural selection.
                    </Typography>
                    <Typography component="div" align="center">

                        {{#query 'chromid' 'fstart' 'fstop' table='annotation' query='{"whcClass":"comparefixed","isCompond":false,"isTrivial":false,"isRoot":true,"ColName":"fid","CompValue":"{{gene_id}}","Tpe":"="}'}}
                        <DocLink
                          button
                          href="viewers/GeneticVariants.html"
                          chromid="{{chromid}}"
                          fstart="{{fstart}}"
                          fstop="{{fstop}}"
                          name="{{../name}}"
                        >
                          <Icon
                            name="docimage:icons/viewer.svg"
                            style="margin-right: 0.5em;"
                          />
                          Explore variation in {{../name}}
                        </DocLink>
                        {{/query}}
                    </Typography>
                </CardContent>
            </Card>
            <DocTemplate path="templates/sop.html"/>
        </CardStack>
    </PageTemplate>
