nameSingle: gene
namePlural: genes

primKey: gene_id

icon: docimage:icons/gene02.svg

properties:
- id: gene_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text
- id: long_name
  dataType: Text
- id: marker_name
  dataType: Text
- id: related_drug_id
  dataType: Text
  relation:                         # This block defines a many-to-one foreign relation to a parent table
      tableId: pf_drugs             # Datatable id of the parent table
      forwardName: blank
      reverseName: blank


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="mapgenome.jpg">
        <BreadCrumb a="pf" b="genes"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                    <Typography type="headline">
                     <em>{{name}}</em> - {{capitalizeAll long_name}}
                    </Typography>
                    <Typography component="div" style="padding-bottom:8px">
                        {{{short_description}}}
                    </Typography>
                    <Typography type="subheading" color="secondary">
                      Plasmodium reference genome gene ID: {{gene_id}}
                    </Typography>
                    <Typography component="div" align="right">
                            <ItemLink table="pf_drugs" primKey="{{related_drug_id}}" button> Drug: {{pf_drugs.name}} </ItemLink>
                    </Typography>
                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                        How is <em>{{../name}}</em> involved in {{lowercase pf_drugs.name}} resistance
                    </Typography>
                    <Typography type="subheading" color="secondary">

                    </Typography>
                    <Typography component="div">
                        {{{../description}}}
                    </Typography>

                    <div class="auto-half-height-container" style="padding-top:10px;">
                       <div class="auto-height-inner">
                            <Map disableInteraction>
                               <TileLayer/>
                               <TableGeoJSONsLayer onClickBehaviour="tooltip" onClickComponent="DocPage"
                                               onClickComponentProps='{"drug_id":"{{pf_drugs.drug_id}}","drug_name":"{{pf_drugs.name}}","dynamicSize":"true", "path":"templates/regionCloroplethTooltip.html"}'
                                               table="pf_regions" geoJsonProperty="geojson" colourProperty="{{pf_drugs.drug_id}}resistance" max=70 min=0 showLegend="false"/>

                           </Map>
                        </div>
                    </div>

                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                    Predicted {{lowercase pf_drugs.name}} resistance by region
                    </Typography>
                    <DocTemplate path="templates/proportionPlotTitle.html"/>
                    <Typography component="div">
                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            proportionTable="pf_samples"
                            proportionTableColourColumn="{{pf_drugs.drug_id}}resistant"
                            proportionTableColourColumnNumeratorValue="resistant"
                            numeratorBarColour="#69B3E4"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{pf_drugs.drug_id}}resistant","CompValue":"resistant","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{pf_drugs.drug_id}}resistant","CompValue":"resistant","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{pf_drugs.drug_id}}resistant","CompValue":"sensitive","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="ItemLink"
                            onClickTable="pf_drug_regions"
                            onClickPrimKey="{{pf_drugs.drug_id}}_{}"
                          />
                        </div>
                    </Typography>
                    <DocTemplate path="templates/proportionPlotLegend.html"/>
                </CardContent>
            </Card>


            <Card>
                <CardContent>
                    <Typography type="headline">
                        Genetic variants in <em>{{name}}</em>
                    </Typography>
                    <Typography type="subheading" color="secondary">

                    </Typography>
                    <Typography component="div">
                        This viewer shows a list of variants in the <strong>{{name}}</strong> gene along with their prevalence in different populations.
                    </Typography>
                    <Typography component="div" align="right">
                        {{#query 'chromid' 'fstart' 'fstop' table='annotation' query='{"whcClass":"comparefixed","isCompond":false,"isTrivial":false,"isRoot":true,"ColName":"fid","CompValue":"{{gene_id}}","Tpe":"="}'}}
                        <DocLink
                          button
                          href="viewers/GeneticVariants.html"
                          chromid="{{chromid}}"
                          fstart="{{fstart}}"
                          fstop="{{fstop}}"
                          name="{{../name}}"
                        >
                          <Icon
                            name="docimage:icons/viewer.svg"
                            style="margin-right: 0.5em;"
                          />
                          Explore in Viewer
                        </DocLink>
                        {{/query}}
                    </Typography>
                </CardContent>
            </Card>
        </CardStack>
    </PageTemplate>
