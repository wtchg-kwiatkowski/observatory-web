nameSingle: gene
namePlural: genes

primKey: gene_id

icon: docimage:icons/gene02.svg

properties:
- id: gene_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text
- id: long_name
  dataType: Text
- id: marker_name
  dataType: Text
- id: related_drug_id
  dataType: Text
  relation:                         # This block defines a many-to-one foreign relation to a parent table
      tableId: pf_drugs             # Datatable id of the parent table
      forwardName: blank
      reverseName: blank


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="mapgenome.jpg">
        <BreadCrumb a="pf" b="genes"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                    <Typography type="headline">
                        {{capitalizeAll long_name}} ({{name}})
                    </Typography>
                    <Typography type="subheading" color="secondary">
                        GENE ID: {{gene_id}}
                    </Typography>
                    <Typography component="div" style="padding-bottom:8px">
                        {{{short_description}}}
                    </Typography>
                    <Typography component="div">
                            <ItemLink table="pf_drugs" primKey="{{related_drug_id}}" button> {{pf_drugs.name}} </ItemLink>
                    </Typography>
                </CardContent>
            </Card>
            {{#query 'drug_id' 'name' table='pf_drugs' query='{"whcClass":"comparefixed","isCompound":false,"isTrivial":false,"isRoot":true,"ColName":"drug_id","CompValue":"{{related_drug_id}}","Tpe":"="}'}}
            <Card>
                <CardContent>
                    <Typography type="headline">
                        How is {{../name}} involved in {{lowercase name}} resistance
                    </Typography>
                    <Typography type="subheading" color="secondary">

                    </Typography>
                    <Typography component="div">
                        {{{../description}}}
                    </Typography>
                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                    Proportion of {{lowercase name}} resistant parasites by region
                    </Typography>
                    <Typography component="div" className="paragraph">
                    This plot shows the predicted number of drug resistant parasites across our <strong> <QueryResult table="pf_regions"/></strong> regions.
                    </Typography>

                    <Typography component="div" className="paragraph">
                    The count of parasites from a region, shown on the right, is a subset of all parasites from a region and includes only those where a confident prediction of resistance can be made. This number does not include those parasites where we're unsure of resistance status due to low quality genotyping data.
                    </Typography>

                    <Typography component="div">
                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            proportionTable="pf_samples"
                            proportionTableColourColumn="{{drug_id}}resistant"
                            proportionTableColourColumnNumeratorValue="yes"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"yes","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"yes","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"no","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="DocLink"
                            docLinkHref="drug_region.html"  drug_id="{{drug_id}}" region_id="{{../region_id}}"
                          />
                        </div>
                    </Typography>
                    <DocTemplate path="templates/warningCardContent.html"/>

                </CardContent>
            </Card>
            {{/query}}


            <Card>
                <CardContent>
                    <Typography type="headline">
                        Genetic variants in <em>{{name}}</em>
                    </Typography>
                    <Typography type="subheading" color="secondary">

                    </Typography>
                    <Typography component="div">
                        This viewer shows a list of variants in the <strong>{{name}}</strong> gene along with their prevalence in different populations.
                    </Typography>
                    <Typography component="div">
                        {{#query 'chromid' 'fstart' 'fstop' table='annotation' query='{"whcClass":"comparefixed","isCompond":false,"isTrivial":false,"isRoot":true,"ColName":"fid","CompValue":"{{gene_id}}","Tpe":"="}'}}


                        <PopupButton target="tab">
                          <Label>
                            <Icon
                              name="docimage:icons/viewer.svg"
                              style="margin-right: 0.5em;"
                            />
                            Explore in Viewer
                          </Label>
                          <Content>
                            <TableWithLegend
                                disableMultipleColumnOrder="true"
                                table="variants"
                                columns='["mutation", "pos", "af_WAF", "af_CAF","af_EAF", "af_WSEA", "af_ESEA", "af_SAS",  "af_SAM", "af_OCE" ]'
                                order='[["desc", "mutation" ]]'
                                query='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"chrom","CompValue":"{{chromid}}","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"pos","CompValue":{{fstart}},"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"pos","CompValue":{{fstop}},"Tpe":"<="},{"whcClass":"compound","isCompound":true,"isRoot":false,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"af_WAF","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_CAF","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_EAF","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_WSEA","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_ESEA","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_SAS","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_SAM","CompValue":0.01,"Tpe":">="},{"whcClass":"comparefixed","isCompound":false,"ColName":"af_OCE","CompValue":0.01,"Tpe":">="}],"Tpe":"OR"}],"Tpe":"AND"}'
                                onClickBehaviour='tooltip'
                                onClickComponent='ItemTemplate'
                                onClickComponentTemplateDocPath='templates/variantsOnClickTooltip.html'
                             >
                                <Typography type="headline">
                                    Genetic variants in {{../name}}
                                </Typography>
                                <Typography type="subheading" color="secondary">
                                    Chromosome {{chromid}}
                                </Typography>
                                <Typography component="div">
                                Each row shows global and regional differentiation at a genetic variant in the <em>P. falciparum</em> genome. For this analysis we use a restricted set of variants that includes only those that have passed quality filters and which are seen in more than 1% of samples in any population.<br/>
                                </Typography>
                            </TableWithLegend>
                          </Content>
                        </PopupButton>
                        {{/query}}
                    </Typography>
                </CardContent>
            </Card>
        </CardStack>
    </PageTemplate>
