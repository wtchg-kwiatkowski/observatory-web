nameSingle: drug
namePlural: drugs

primKey: drug_id

icon: docimage:icons/drug02.svg

properties:
- id: drug_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="drugs.jpg">
        <BreadCrumb a="pf" b="drugs"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                    <Typography type="headline">
                        {{name}}
                    </Typography>
                    <Typography component="p" style="padding-bottom:8px">
                        {{{description}}}
                    </Typography>
                    <Typography component="div">
                        {{#each pf_resgenes}}
                            <ItemLink table="pf_resgenes" primKey="{{gene_id}}" button> {{name}} </ItemLink>
                        {{/each}}
                    </Typography>
                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                     Proportion of {{lowercase name}} resistant parasites by region
                    </Typography>

                    <Typography component="div" className="paragraph">
                    This plot shows the predicted number of drug resistant parasites across our <strong> <QueryResult table="pf_regions"/></strong> regions.
                    </Typography>

                    <Typography component="div" className="paragraph">
                    The count of parasites from a region, shown on the right, is a subset of all parasites from a region and includes only those where a confident prediction of resistance can be made. This number does not include those parasites where we're unsure of resistance status due to low quality genotyping data.
                    </Typography>

                    
                    <Typography component="div">
                      
                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            proportionTable="pf_samples"
                            proportionTableColourColumn="{{drug_id}}resistant"
                            proportionTableColourColumnNumeratorValue="yes"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"sensitive","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="DocLink"
                            docLinkHref="drug_region.html"  drug_id="{{drug_id}}"
                          />
                        </div>

                    </Typography>
                    <DocTemplate path="templates/warningCardContent.html"/>


                </CardContent>
            </Card>
            <Card >
                <CardContent>
                    <Typography type="headline">
                        How we predict resistance
                    </Typography>
                    <List>
                      <ObsListItem download href="downloads/Markers_to_phenotype_mapping_-_SOP_v1_1.pdf" target="_blank">
                        <ListItemIcon><Icon class="icon" name='docimage:icons/publications-reports.svg' />
                        </ListItemIcon>
                          <ListItemText>
                          <span>Our standard operating procedure for inferring antimalarial resistance from DNA</span>
                        </ListItemText>
                      </ObsListItem>
                    </List>
                </CardContent>
            </Card>

        </CardStack>
    </PageTemplate>
