nameSingle: drug
namePlural: drugs

primKey: drug_id

icon: docimage:icons/drug02.svg

properties:
- id: drug_id
  dataType: Text
- id: short_description
  dataType: Text
- id: description
  dataType: Text
- id: name
  dataType: Text


dataItemViews:              # Lists the custom views that should appear in the popup for an individual data table item
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <PageTemplate bgurl="drugs.jpg">
        <BreadCrumb a="pf" b="drugs"><span>{{name}}</span></BreadCrumb>
        <CardStack>
            <Card>
                <CardContent>
                    <Typography type="headline">
                        {{name}}
                    </Typography>
                    <Typography component="p" style="padding-bottom:8px">
                        {{{description}}}
                    </Typography>
                    <Typography component="div" align="right">
                        {{#each pf_resgenes}}
                            <ItemLink table="pf_resgenes" primKey="{{gene_id}}" button> {{name}} </ItemLink>
                        {{/each}}
                    </Typography>
                <div class="auto-half-height-container" style="padding-top:10px;">
                   <div class="auto-height-inner">
                        <Map disableInteraction>
                           <TileLayer/>
                           <TableGeoJSONsLayer disableClick table="countries" geoJsonProperty="geojson" colourProperty="{{drug_id}}resistance" max=100 min=0 showLegend="true"/>
                           <TableMarkersLayer disableOnClickMarker table="sites" clusterMarkers="false">
                           <svg style="pointer-events:none; width: 4px; height: 4px; position: absolute; left: -2px; top: -2px;" viewBox="0 0 100 100">
                           <circle cx="50" cy="50" r="50" strokeWidth="0" fill="black" opacity="0.5" />
                               </svg>
                           </TableMarkersLayer>
                       </Map>
                    </div>
                </div>
                <Typography component="div" align="right" style="padding-top:10px;">
                <PopupButton target="tab">
                  <Label>
                    <Icon
                      baseURL="/panoptes/Docs/observatory/images/icons/"
                      name="image:viewer.svg"
                      style="margin-right: 0.5em"
                    />
                    Explore in Viewer
                  </Label>
                  <Content>
                    <ResistanceMap/>
                  </Content>
                </PopupButton>
                </Typography>
                </CardContent>
            </Card>
            <Card>
                <CardContent>
                    <Typography type="headline">
                     {{name}} resistance by region
                    </Typography>

                    <DocTemplate path="templates/proportionPlotTitle.html"/>
                    <Typography component="div">

                        <div style="padding-top: 20px">
                          <ProportionBarChart
                            rowTable="pf_regions"
                            proportionTable="pf_samples"
                            proportionTableColourColumn="{{drug_id}}resistant"
                            proportionTableColourColumnNumeratorValue="resistant"
                            numeratorBarColour="#69B3E4"
                            numeratorQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="}'
                            denominatorQuery='{"whcClass":"compound","isCompound":true,"isRoot":true,"Components":[{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"resistant","Tpe":"="},{"whcClass":"comparefixed","isCompound":false,"ColName":"{{drug_id}}resistant","CompValue":"sensitive","Tpe":"="}],"Tpe":"OR"}'
                            remainderTextColour="inherit"
                            numberOfTickLabels="5"
                            onClickBehaviour="ItemLink"
                            onClickTable="pf_drug_regions"
                            onClickPrimKey="{{drug_id}}_{}"
                          />
                        </div>

                    </Typography>
                    <DocTemplate path="templates/proportionPlotLegend.html"/>

                </CardContent>
            </Card>
            <Card >
                <CardContent>
                    <Typography type="headline">
                        How we predict resistance
                    </Typography>
                    <List>
                      <ObsListItem download href="downloads/Markers_to_phenotype_mapping_-_SOP_v1_1.pdf" target="_blank">
                        <ListItemIcon><Icon class="icon" name='docimage:icons/publications-reports.svg' />
                        </ListItemIcon>
                          <ListItemText>
                          <span>Our standard operating procedure for inferring antimalarial resistance from DNA</span>
                        </ListItemText>
                      </ObsListItem>
                    </List>
                </CardContent>
            </Card>

        </CardStack>
    </PageTemplate>
