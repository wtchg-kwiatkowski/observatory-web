# For more information about this file, see: http://panoptes.readthedocs.org/en/latest/importdata/importsettings/datatable.html

nameSingle: site     # Display name referring to a table item (single, no capital)
namePlural: sites    # Display name referring to a table item (plural, no capital)
description: Information about the sites where samples were collected     # A description of this data table

icon: fa-map-marker

# The primary key column ID for this table. This should correspond to a column in data containing a unique value for each record
# Optionally, this parameter can be set to 'AutoKey' to instruct the software to automatically generate a primary key
primKey: SiteID
isPositionOnGenome: false

# The following list of properties will be used by some tools that allow the user to quickly find a (set of) item(s)
quickFindFields: SiteID,CountryCode

# Defines the default property to sort the table
sortDefault: CountryCode

listView: true
itemTitle: "{{#isnt CountryCode 'Lab'}}<img style='width:20px; padding-right:5px' src='https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/2.8.0/flags/4x3/{{lowercase CountryCode}}.svg'/>{{SiteID}}, {{CountryCode}}{{else}}Lab samples{{/isnt}}"

# The following lists all the columns in the data files, and tells Panoptes how to interpret them as properties of the data items
# NOTE: Optionally, "AutoScanProperties=true" can be used to instruct Panoptes to automatically import all data table columns
# Both mechanisms can be combined: further settings can still be specified for individual properties
properties:
- id: SiteID                                         # Identifier of the property, corresponding to the column header in the [data] file
  name: Site ID                                      # Display name of the property
  description: Unique identifier of a sampling site  # Description of the property
  dataType: Text                                     # Data type of the values in the property. This can be Text, Value, Boolean,  GeoLongitude, GeoLatitude, Date
  search: StartPattern

- id: CountryCode
  name: Country Code
  dataType: Text
  isCategorical: true        # This directive instructs Panoptes to treat the property as a categorical variable. For example, a combo box with the possible states is automatically shown in queries for this property
  index: true                # Instructs Panoptes to create a database index for this property. For large data tables, this massively speeds up queries based on this field
  search: Pattern

- id: Lat
  name: Latitude
  dataType: GeoLatitude     # Specifies a geographic latitude property

- id: Long
  name: Longitude
  dataType: GeoLongitude     # Specifies a geographic longitude property

- id: Source
  name: Source
  dataType: Text
#- id: Contributor_ID
#  name: Contributor_ID
#  description: Identifier of the contributing entity
#  dataType: Text
#  index: true                       # Instructs Panoptes to create a database index for this property. For large data tables, this massively speeds up queries based on this field
#  relation:                         # This block defines a many-to-one foreign relation to a parent table
#    tableId: contributors           # Data table id of the parent table
#    forwardName: is contributed by  # Display name of the relation from child to parent
#    reverseName: contributed from   # Display name of the relation from parent to child



externalLinks:
- url: http://maps.google.com/maps?q={Lat},{Long}
  name: Show on Google Maps



dataItemViews:
- type: Template                                       # Add a template based view
  name: Details
  content: |
    <div style="float: right;width: 30%;margin-left:20px">
        <Card style="height:300px;">
            <div style="height:300px;">
                <Map zoom=3>
                    <TileLayer />
                    <TableMarkersLayer table="sites" primKey="{{SiteID}}"/>
                    <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                </Map>
            </div>
        </Card>
    </div>
    <h2>
        {{#isnt CountryCode 'Lab'}}
            <img style='width:50px; padding-right:5px; vertical-align: middle' src='https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/2.8.0/flags/4x3/{{lowercase CountryCode}}.svg'/>
            {{SiteID}}, <ItemLink table="countries" primKey="{{CountryCode}}" />
        {{else}}
            Lab samples
        {{/isnt}}
        - <QueryResult table="samples" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/> samples
    </h2>
    <div style="padding-top:10px">
      <PopupButton icon="{{config.tablesById.samples.icon}}" label="Samples from this site" target="tab">
        <DataTableWithActions table="samples" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
      </PopupButton>
      <PopupButton icon="table" label="Genotypes" target="tab">
        <GenomeBrowserWithActions>
          <PerRowIndicatorChannel table="variants" colourProperty="is_snp" />
          <GenotypesChannel table="genotypes" rowLabel="Site" rowSort="Site" rowQuery='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
        </GenomeBrowserWithActions>
      </PopupButton>
    </div>
        <div style="max-width:60%">
    <Tabs>
      <Tab label="Year">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="Site" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
      </Tab>
      <Tab label="Species">
        <PivotTableView table="samples" columnProperty="SampleClass" rowProperty="Site" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
      </Tab>
    </Tabs>
    </div>
    <div style="padding-top:20px">
    <h3>Genome-determined resistance status:</h3>
    <Tabs>
      <Tab label="Chloroquine">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="CQresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                    <div style="margin-top:20px;height:400px;">
                        <Map zoom=3>
                            <TileLayer />
                            <TableMarkersLayer table="samples" markerColourProperty="CQresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                            <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                        </Map>
                    </div>

      </Tab>
      <Tab label="Pyrimethamine">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="PYRresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                            <div style="margin-top:20px;height:400px;">
                                <Map zoom=3>
                                    <TileLayer />
                                    <TableMarkersLayer table="samples" markerColourProperty="PYRresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                                    <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                                </Map>
                            </div>

      </Tab>
      <Tab label="Sulfadoxine">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="SDXresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                            <div style="margin-top:20px;height:400px;">
                                <Map zoom=3>
                                    <TileLayer />
                                    <TableMarkersLayer table="samples" markerColourProperty="SDXresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                                    <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                                </Map>
                            </div>

      </Tab>
      <Tab label="Mefloquine">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="MQresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                            <div style="margin-top:20px;height:400px;">
                                <Map zoom=3>
                                    <TileLayer />
                                    <TableMarkersLayer table="samples" markerColourProperty="MQresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                                    <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                                </Map>
                            </div>

      </Tab>
      <Tab label="Artemisinin">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="ARTresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                            <div style="margin-top:20px;height:400px;">
                                <Map zoom=3>
                                    <TileLayer />
                                    <TableMarkersLayer table="samples" markerColourProperty="ARTresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                                    <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                                </Map>
                            </div>

      </Tab>
      <Tab label="Piperaquine">
        <PivotTableView table="samples" columnProperty="Year" rowProperty="PPQresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                            <div style="margin-top:20px;height:400px;">
                                <Map zoom=3>
                                    <TileLayer />
                                    <TableMarkersLayer table="samples" markerColourProperty="PPQresistant" query='{"whcClass":"comparefixed","isCompound":false,"ColName":"Site","CompValue":"{{SiteID}}","isRoot":true,"Tpe":"="}'/>
                                    <TileLayer url="/panoptes/Maps/Pf60/MODEL43.2015.inc.rate.PR.rmean.stable/tiles/{z}/{x}/{y}.png" maxNativeZoom=8 maxZoom=17 minZoom=0 opacity=0.6 tms="true" ext="png" zIndex=17 attribution="Malaria Atlas Project"/>
                                </Map>
                            </div>

      </Tab>
    </Tabs>
    </div>

    